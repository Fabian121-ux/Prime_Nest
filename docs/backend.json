{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the Prime Nest application.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "fullName": {
          "type": "string",
          "description": "Full name of the user."
        },
        "rolePrimary": {
          "type": "string",
          "description": "Primary role of the user (tenant, landlord, artisan, or admin)."
        },
        "roles": {
          "type": "array",
          "description": "Array of roles the user has.",
          "items": {
            "type": "string"
          }
        },
        "trustTier": {
          "type": "number",
          "description": "Trust tier of the user (0-4)."
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates whether the user is verified."
        },
        "status": {
          "type": "string",
          "description": "Status of the user account (active, suspended, banned)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "userId",
        "email",
        "rolePrimary",
        "trustTier",
        "isVerified",
        "status",
        "createdAt",
        "updatedAt"
      ]
    },
    "TenantProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TenantProfile",
      "type": "object",
      "description": "Represents the profile information specific to a tenant.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 TenantProfile)"
        },
        "preferredLocation": {
          "type": "string",
          "description": "Preferred location for the tenant."
        },
        "budgetRange": {
          "type": "string",
          "description": "Budget range of the tenant."
        }
      },
      "required": [
        "userId"
      ]
    },
    "LandlordProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LandlordProfile",
      "type": "object",
      "description": "Represents the profile information specific to a landlord.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 LandlordProfile)"
        },
        "totalProperties": {
          "type": "number",
          "description": "Total number of properties owned by the landlord."
        }
      },
      "required": [
        "userId"
      ]
    },
    "ArtisanProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ArtisanProfile",
      "type": "object",
      "description": "Represents the profile information specific to an artisan.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:1 ArtisanProfile)"
        },
        "skills": {
          "type": "array",
          "description": "Array of skills possessed by the artisan.",
          "items": {
            "type": "string"
          }
        },
        "hourlyRate": {
          "type": "number",
          "description": "Hourly rate of the artisan."
        }
      },
      "required": [
        "userId"
      ]
    },
    "Listing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Listing",
      "type": "object",
      "description": "Represents a listing for a property, job, or service.",
      "properties": {
        "listingId": {
          "type": "string",
          "description": "Unique identifier for the Listing entity."
        },
        "ownerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Listing)"
        },
        "type": {
          "type": "string",
          "description": "Type of listing (rental, job, or service)."
        },
        "title": {
          "type": "string",
          "description": "Title of the listing."
        },
        "description": {
          "type": "string",
          "description": "Description of the listing."
        },
        "price": {
          "type": "number",
          "description": "Price of the listing."
        },
        "location": {
          "type": "string",
          "description": "Location of the listing."
        },
        "status": {
          "type": "string",
          "description": "Status of the listing (draft, active, closed)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the listing was created.",
          "format": "date-time"
        }
      },
      "required": [
        "listingId",
        "ownerId",
        "type",
        "title",
        "price",
        "status",
        "createdAt"
      ]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "type": "object",
      "description": "Represents a chat thread between two users related to a listing.",
      "properties": {
        "conversationId": {
          "type": "string",
          "description": "Unique identifier for the Conversation entity."
        },
        "listingId": {
          "type": "string",
          "description": "Reference to Listing. (Relationship: Listing 1:N Conversation)"
        },
        "participants": {
          "type": "array",
          "description": "Array of user IDs participating in the conversation.",
          "items": {
            "type": "string"
          }
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the conversation was created.",
          "format": "date-time"
        }
      },
      "required": [
        "conversationId",
        "listingId",
        "participants",
        "createdAt"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a chat message within a conversation.",
      "properties": {
        "messageId": {
          "type": "string",
          "description": "Unique identifier for the Message entity."
        },
        "conversationId": {
          "type": "string",
          "description": "Reference to Conversation. (Relationship: Conversation 1:N Message)"
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Message, Sender)"
        },
        "content": {
          "type": "string",
          "description": "Content of the message."
        },
        "type": {
          "type": "string",
          "description": "Type of message (text, system, or escrow)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the message was created.",
          "format": "date-time"
        }
      },
      "required": [
        "messageId",
        "conversationId",
        "senderId",
        "content",
        "type",
        "createdAt"
      ]
    },
    "Escrow": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Escrow",
      "type": "object",
      "description": "Represents an escrow transaction.",
      "properties": {
        "escrowId": {
          "type": "string",
          "description": "Unique identifier for the Escrow entity."
        },
        "payerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Escrow, Payer)"
        },
        "payeeId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Escrow, Payee)"
        },
        "listingId": {
          "type": "string",
          "description": "Reference to Listing. (Relationship: Listing 1:N Escrow)"
        },
        "amount": {
          "type": "number",
          "description": "Amount of the escrow transaction."
        },
        "currency": {
          "type": "string",
          "description": "Currency of the escrow transaction (e.g., NGN)."
        },
        "status": {
          "type": "string",
          "description": "Status of the escrow transaction (initiated, held, disputed, released, refunded)."
        },
        "currentStage": {
          "type": "string",
          "description": "The current stage of the escrow process."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the escrow transaction was created.",
          "format": "date-time"
        }
      },
      "required": [
        "escrowId",
        "payerId",
        "payeeId",
        "listingId",
        "amount",
        "currency",
        "status",
        "createdAt"
      ]
    },
    "EscrowEvent": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EscrowEvent",
      "type": "object",
      "description": "Represents an audit log event for an escrow transaction.",
      "properties": {
        "eventId": {
          "type": "string",
          "description": "Unique identifier for the EscrowEvent entity."
        },
        "escrowId": {
          "type": "string",
          "description": "Reference to Escrow. (Relationship: Escrow 1:N EscrowEvent)"
        },
        "actorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EscrowEvent, Actor)"
        },
        "action": {
          "type": "string",
          "description": "Action performed on the escrow transaction (created, released, disputed)."
        },
        "evidenceUrl": {
          "type": "string",
          "description": "URL of evidence related to the escrow event.",
          "format": "uri"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the escrow event was created.",
          "format": "date-time"
        }
      },
      "required": [
        "eventId",
        "escrowId",
        "actorId",
        "action",
        "createdAt"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review of a user or listing.",
      "properties": {
        "reviewId": {
          "type": "string",
          "description": "Unique identifier for the Review entity."
        },
        "reviewerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review, Reviewer)"
        },
        "revieweeId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review, Reviewee)"
        },
        "listingId": {
          "type": "string",
          "description": "Reference to Listing. (Relationship: Listing 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given in the review (1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Comment provided in the review."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the review was created.",
          "format": "date-time"
        }
      },
      "required": [
        "reviewId",
        "reviewerId",
        "revieweeId",
        "listingId",
        "rating",
        "createdAt"
      ]
    },
    "AdminAction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AdminAction",
      "type": "object",
      "description": "Represents an action performed by an administrator.",
      "properties": {
        "actionId": {
          "type": "string",
          "description": "Unique identifier for the AdminAction entity."
        },
        "adminId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N AdminAction, Admin)"
        },
        "targetType": {
          "type": "string",
          "description": "Type of target affected by the admin action (user, listing, or escrow)."
        },
        "targetId": {
          "type": "string",
          "description": "Identifier of the target affected by the admin action."
        },
        "action": {
          "type": "string",
          "description": "The admin action performed."
        },
        "reason": {
          "type": "string",
          "description": "Reason for the admin action."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the admin action was created.",
          "format": "date-time"
        }
      },
      "required": [
        "actionId",
        "adminId",
        "targetType",
        "targetId",
        "action",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user account information. Uses userId as the document ID.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/tenant_profiles/{userId}",
        "definition": {
          "entityName": "TenantProfile",
          "schema": {
            "$ref": "#/backend/entities/TenantProfile"
          },
          "description": "Stores tenant-specific profile information. Uses userId as the document ID to link to the user document.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the tenant."
            }
          ]
        }
      },
      {
        "path": "/landlord_profiles/{userId}",
        "definition": {
          "entityName": "LandlordProfile",
          "schema": {
            "$ref": "#/backend/entities/LandlordProfile"
          },
          "description": "Stores landlord-specific profile information. Uses userId as the document ID to link to the user document.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the landlord."
            }
          ]
        }
      },
      {
        "path": "/artisan_profiles/{userId}",
        "definition": {
          "entityName": "ArtisanProfile",
          "schema": {
            "$ref": "#/backend/entities/ArtisanProfile"
          },
          "description": "Stores artisan-specific profile information. Uses userId as the document ID to link to the user document.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the artisan."
            }
          ]
        }
      },
      {
        "path": "/listings/{listingId}",
        "definition": {
          "entityName": "Listing",
          "schema": {
            "$ref": "#/backend/entities/Listing"
          },
          "description": "Stores listing information. Uses listingId as the document ID.",
          "params": [
            {
              "name": "listingId",
              "description": "Unique identifier for the listing."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": {
            "$ref": "#/backend/entities/Conversation"
          },
          "description": "Stores conversation thread information. Uses conversationId as the document ID.",
          "params": [
            {
              "name": "conversationId",
              "description": "Unique identifier for the conversation."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores chat message information. Uses messageId as the document ID.",
          "params": [
            {
              "name": "messageId",
              "description": "Unique identifier for the message."
            }
          ]
        }
      },
      {
        "path": "/escrows/{escrowId}",
        "definition": {
          "entityName": "Escrow",
          "schema": {
            "$ref": "#/backend/entities/Escrow"
          },
          "description": "Stores escrow transaction information. Uses escrowId as the document ID.",
          "params": [
            {
              "name": "escrowId",
              "description": "Unique identifier for the escrow."
            }
          ]
        }
      },
      {
        "path": "/escrow_events/{eventId}",
        "definition": {
          "entityName": "EscrowEvent",
          "schema": {
            "$ref": "#/backend/entities/EscrowEvent"
          },
          "description": "Stores audit log events for escrow transactions. Uses eventId as the document ID.",
          "params": [
            {
              "name": "eventId",
              "description": "Unique identifier for the escrow event."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews of users or listings. Uses reviewId as the document ID.",
          "params": [
            {
              "name": "reviewId",
              "description": "Unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/admin_actions/{actionId}",
        "definition": {
          "entityName": "AdminAction",
          "schema": {
            "$ref": "#/backend/entities/AdminAction"
          },
          "description": "Stores actions performed by administrators. Uses actionId as the document ID.",
          "params": [
            {
              "name": "actionId",
              "description": "Unique identifier for the admin action."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to mirror a relational database structure, prioritizing migration readiness to Postgres. Each entity has its own top-level collection, and relationships are maintained using foreign-key-style IDs. This design emphasizes flat collections and avoids nested data to ensure rule simplicity and prevent performance bottlenecks.\n\nAuthorization Independence is achieved through path-based ownership for user-specific data (e.g., `/users/{userId}/drafts`) and explicit role checks via the `rolePrimary` field within the `users` collection. Although no membership maps are explicitly used, the structure still maintains Authorization Independence, since we can directly check `request.auth.uid` within the rules, without relying on parent data via `get()` calls.\n\nQAPs are supported by structural segregation. For example, user profiles are separated into `tenant_profiles`, `landlord_profiles`, and `artisan_profiles`, so listing operations will be separated based on role, improving efficiency and security."
  }
}